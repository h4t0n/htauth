// (c) 2015 Andrea Tarquini @h4t0n
!function(e,t){"use strict";t.module("htauth",[])}(window,angular),function(t,n){"use strict";t.provider("htauth.google",function(){var t,o=!1,r={};r.client_id=!1,this.init=function(e){["client_id","cookie_policy","scope","fetch_basic_profile","hosted_domain","openid_realm"].forEach(function(t){e[t]&&(r[t]=e[t])})},this.getSettings=function(){return JSON.parse(JSON.stringify(r))},this.$get=["$window","$q","$timeout","$rootScope",function(i,s,a,c){function u(){function n(){return o?void r():a(n,500)}function r(){t.signIn().then(function(e){c.$digest(),i.resolve(e.getAuthResponse())},function(t){if(t.reason)switch(t.reason){case"Access denied.":e=new Error("app not authorized"),e.name="AuthorizationError",i.reject(e);break;default:e=new Error(e.reason),e.name="LoginError",i.reject(e)}})}var i=s.defer();return n(),i.promise}function f(){return o&&t.isSignedIn.get()}function d(){if(f()){var e=t.currentUser.get();return e.getAuthResponse()}}return i.onLoadCallback=function(){gapi.load("auth2",function(){t=gapi.auth2.init(r),t.then(function(){o=!0,c.$digest()})})},function(e){var t,n="google-jssdk",o=e.getElementsByTagName("script")[0];e.getElementById(n)||i.gapi||(t=e.createElement("script"),t.id=n,t.async=!0,t.defer=!0,t.src="//apis.google.com/js/platform.js?onload=onLoadCallback",o.parentNode.insertBefore(t,o))}(n),{login:u,isLogged:f,getAuthResponse:d,getIdToken:function(){var e=d();return e?e.id_token:void 0}}}]})}(angular.module("htauth"),document),function(e,t){"use strict";e.provider("htauth.facebook",function(){var e=!1,n={};n.appId=!1,n.cookie=!0,n.status=!0,n.xfbml=!1,n.version="v2.5",n.locale="en_US",n.scope="public_profile,email";var o,r=!1;this.init=function(e){["status","cookie","xfbml","appId","version","locale","scope"].forEach(function(t){e[t]&&(n[t]=e[t])})},this.getSettings=function(){return JSON.parse(JSON.stringify(n))},this.$get=["$window","$q","$timeout","$rootScope",function(i,s,a,c){function u(){function t(){return e?void i():a(t,500)}function i(){FB.login(function(e){var t;switch(e.status||(t=new Error("response has not any status"),t.name="LoginError",u.reject(t)),e.status){case"connected":o=e.authResponse,r=!0,u.resolve(o||"logged");break;case"not_authorized":t=new Error("app not authorized"),t.name="AuthorizationError",u.reject(t);break;default:t=new Error("unknow response status"),t.name="LoginError",u.reject(t)}c.$digest()},{scope:n.scope})}var u=s.defer();return t(),u.promise}return i.fbAsyncInit=function(){FB.init({appId:n.appId,status:n.status,cookie:n.cookie,xfbml:n.xfbml,version:n.version}),e=!0,FB.getLoginStatus(function(e){"connected"===e.status&&(o=e.authResponse,r=!0,c.$digest())})},function(e){var t,o="facebook-jssdk",r=e.getElementsByTagName("script")[0];e.getElementById(o)||(t=e.createElement("script"),t.id=o,t.async=!0,t.src="//connect.facebook.net/"+n.locale+"/all.js",r.parentNode.insertBefore(t,r))}(t),{login:u,isLogged:function(){return r},getAuthResponse:function(){return o},getAccessToken:function(){return o?o.accessToken||void 0:void 0}}}]})}(angular.module("htauth"),document);